import numpy as np

from soccertrack.dataframe import CoordinatesDataFrame
from soccertrack.rate.agg_func import get_agg_func


def rate_xG(
    codf: CoordinatesDataFrame,
    agg_func=None,
    grid_xmin=0,
    grid_ymin=0,
    grid_xmax=105,
    grid_ymax=68,
    **agg_kwargs,
):
    window_x = 16
    window_y = 12

    pitch_length_x = np.linspace(grid_xmin, grid_xmax, window_x)
    pitch_length_y = np.linspace(grid_ymin, grid_ymax, window_y)

    ball_traj = codf.xs("ball", level="TeamID", axis=1).values

    x_bin = np.digitize(ball_traj[:, 0], pitch_length_x) - 1
    y_bin = np.digitize(ball_traj[:, 1], pitch_length_y) - 1
    xg_scores = get_agg_func(agg_func, **agg_kwargs)(xg_mtx[x_bin, y_bin])
    return xg_scores

def rate_xT(
    codf: CoordinatesDataFrame,
    agg_func=None,
    grid_xmin=0,
    grid_ymin=0,
    grid_xmax=105,
    grid_ymax=68,
    **agg_kwargs,
):
    window_x = 16
    window_y = 12

    pitch_length_x = np.linspace(grid_xmin, grid_xmax, window_x)
    pitch_length_y = np.linspace(grid_ymin, grid_ymax, window_y)

    ball_traj = codf.xs("ball", level="TeamID", axis=1).values

    x_bin = np.digitize(ball_traj[:, 0], pitch_length_x) - 1
    y_bin = np.digitize(ball_traj[:, 1], pitch_length_y) - 1
    xt_scores = get_agg_func(agg_func, **agg_kwargs)(xt_mtx[x_bin, y_bin])
    return xt_scores


window_x = 16
window_y = 12

xg_mtx = np.array(
    [
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        [0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02],
        [0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02],
        [0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04],
        [0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04],
        [0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04],
        [0.11, 0.11, 0.07, 0.07, 0.07, 0.15, 0.15, 0.07, 0.07, 0.07, 0.11, 0.11],
        [0.11, 0.11, 0.07, 0.07, 0.07, 0.15, 0.15, 0.07, 0.07, 0.07, 0.11, 0.11],
        [0.11, 0.11, 0.07, 0.07, 0.1, 0.34, 0.34, 0.1, 0.07, 0.07, 0.11, 0.11],
    ]
)


xt_mtx = np.array(
    [
        [
            0.002,
            0.003,
            0.003,
            0.004,
            0.005,
            0.004,
            0.004,
            0.005,
            0.004,
            0.003,
            0.003,
            0.003,
        ],
        [
            0.003,
            0.003,
            0.004,
            0.005,
            0.006,
            0.005,
            0.005,
            0.005,
            0.004,
            0.003,
            0.005,
            0.004,
        ],
        [
            0.004,
            0.004,
            0.004,
            0.005,
            0.007,
            0.007,
            0.007,
            0.006,
            0.004,
            0.003,
            0.004,
            0.003,
        ],
        [
            0.004,
            0.004,
            0.004,
            0.004,
            0.005,
            0.005,
            0.004,
            0.004,
            0.004,
            0.004,
            0.004,
            0.004,
        ],
        [
            0.005,
            0.005,
            0.005,
            0.004,
            0.005,
            0.005,
            0.004,
            0.004,
            0.004,
            0.004,
            0.004,
            0.004,
        ],
        [
            0.006,
            0.006,
            0.006,
            0.006,
            0.006,
            0.005,
            0.006,
            0.006,
            0.006,
            0.006,
            0.005,
            0.006,
        ],
        [
            0.007,
            0.008,
            0.008,
            0.008,
            0.008,
            0.008,
            0.008,
            0.007,
            0.007,
            0.007,
            0.007,
            0.007,
        ],
        [
            0.008,
            0.01,
            0.01,
            0.009,
            0.009,
            0.01,
            0.009,
            0.01,
            0.009,
            0.009,
            0.008,
            0.008,
        ],
        [
            0.011,
            0.012,
            0.013,
            0.013,
            0.014,
            0.012,
            0.013,
            0.013,
            0.012,
            0.012,
            0.011,
            0.01,
        ],
        [
            0.014,
            0.015,
            0.016,
            0.017,
            0.018,
            0.019,
            0.017,
            0.017,
            0.016,
            0.016,
            0.015,
            0.013,
        ],
        [
            0.019,
            0.022,
            0.024,
            0.024,
            0.024,
            0.025,
            0.025,
            0.025,
            0.023,
            0.022,
            0.02,
            0.018,
        ],
        [
            0.026,
            0.031,
            0.036,
            0.036,
            0.037,
            0.035,
            0.033,
            0.033,
            0.034,
            0.034,
            0.029,
            0.025,
        ],
        [
            0.039,
            0.044,
            0.049,
            0.047,
            0.046,
            0.042,
            0.052,
            0.048,
            0.044,
            0.046,
            0.042,
            0.037,
        ],
        [
            0.051,
            0.06,
            0.068,
            0.065,
            0.077,
            0.116,
            0.089,
            0.068,
            0.068,
            0.067,
            0.056,
            0.048,
        ],
        [
            0.063,
            0.077,
            0.096,
            0.096,
            0.124,
            0.176,
            0.171,
            0.126,
            0.089,
            0.094,
            0.075,
            0.06,
        ],
        [
            0.068,
            0.094,
            0.136,
            0.126,
            0.158,
            0.371,
            0.413,
            0.158,
            0.123,
            0.103,
            0.092,
            0.066,
        ],
    ]
)
